<!DOCTYPE html>
<!-- @version 2.1.28 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Intelligence Chat Integration Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    /* Chat Section */
    .chat-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-height: 800px;
    }

    .chat-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 16px 16px 0 0;
      text-align: center;
    }

    .chat-header h1 {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .chat-header p {
      font-size: 12px;
      opacity: 0.9;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      display: flex;
      gap: 10px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      justify-content: flex-end;
    }

    .message-content {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 12px;
      word-wrap: break-word;
      line-height: 1.4;
      font-size: 14px;
    }

    .message.user .message-content {
      background: #667eea;
      color: white;
      border-radius: 12px 0 12px 12px;
    }

    .message.bot .message-content {
      background: #f0f0f0;
      color: #333;
      border-radius: 0 12px 12px 12px;
    }

    .message-intelligence {
      width: 100%;
      margin-top: 8px;
      padding: 0;
    }

    /* Input Section */
    .input-section {
      border-top: 1px solid #e0e0e0;
      padding: 16px;
      display: flex;
      gap: 10px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #5568d3;
    }

    button:active {
      transform: scale(0.98);
    }

    /* Analytics Section */
    .analytics-panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 24px;
      height: 100vh;
      max-height: 800px;
      overflow-y: auto;
    }

    .analytics-header {
      font-size: 20px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 16px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .stat-label {
      font-size: 12px;
      color: #7f8c8d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #2c3e50;
    }

    .stat-unit {
      font-size: 14px;
      color: #95a5a6;
      margin-left: 4px;
    }

    .distribution-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e0e0e0;
    }

    .distribution-title {
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 12px;
    }

    .distribution-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .distribution-label {
      font-size: 12px;
      color: #7f8c8d;
      min-width: 100px;
      text-transform: capitalize;
    }

    .distribution-chart {
      flex: 1;
      display: flex;
      height: 24px;
      border-radius: 4px;
      overflow: hidden;
      background: #ecf0f1;
    }

    .distribution-segment {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 600;
      color: white;
      min-width: 24px;
    }

    .segment-critical { background: #27ae60; }
    .segment-high { background: #3498db; }
    .segment-moderate { background: #f39c12; }
    .segment-low { background: #e74c3c; }
    .segment-accept { background: #27ae60; }
    .segment-caution { background: #f39c12; }
    .segment-review { background: #e74c3c; }
    .segment-revise { background: #c0392b; }

    .action-buttons {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .small-btn {
      padding: 8px 12px;
      font-size: 12px;
      background: #ecf0f1;
      color: #2c3e50;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .small-btn:hover {
      background: #bdc3c7;
    }

    .info-box {
      background: #f0f7ff;
      border-left: 3px solid #3498db;
      padding: 12px;
      border-radius: 6px;
      font-size: 12px;
      color: #2c3e50;
      margin-top: 16px;
    }

    .loading {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .error {
      background: #fdf5f3;
      border-left-color: #e74c3c;
      color: #c0392b;
    }

    .success {
      background: #f0fdf4;
      border-left-color: #27ae60;
      color: #27ae60;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Chat Panel -->
    <div class="chat-panel">
      <div class="chat-header">
        <h1>üí¨ Smart Chat</h1>
        <p>With Real-time Intelligence Analysis</p>
      </div>

      <div class="messages" id="messages">
        <div class="message bot">
          <div class="message-content">
            Hi! Ask me anything and I'll analyze my response with smart intelligence to ensure high confidence accuracy.
          </div>
        </div>
      </div>

      <div class="input-section">
        <input 
          type="text" 
          id="questionInput" 
          placeholder="Ask a question..."
          onkeypress="handleKeypress(event)"
        />
        <button onclick="askQuestion()">Send</button>
      </div>
    </div>

    <!-- Analytics Panel -->
    <div class="analytics-panel">
      <div class="analytics-header">
        üìä Intelligence Analytics
      </div>

      <div class="stat-grid">
        <div class="stat-card">
          <div class="stat-label">Total Analyses</div>
          <div class="stat-value" id="totalAnalyses">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Confidence</div>
          <div class="stat-value">
            <span id="avgConfidence">--</span>
            <span class="stat-unit">/100</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Insights</div>
          <div class="stat-value" id="avgInsights">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Issues</div>
          <div class="stat-value" id="avgIssues">0</div>
        </div>
      </div>

      <!-- Confidence Distribution -->
      <div class="distribution-section">
        <div class="distribution-title">üéØ Confidence Distribution</div>
        <div class="distribution-bar">
          <div class="distribution-label">Responses</div>
          <div class="distribution-chart" id="confidenceChart">
            <div class="distribution-segment segment-critical" style="width: 0%"></div>
            <div class="distribution-segment segment-high" style="width: 0%"></div>
            <div class="distribution-segment segment-moderate" style="width: 0%"></div>
            <div class="distribution-segment segment-low" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <!-- Action Distribution -->
      <div class="distribution-section">
        <div class="distribution-title">‚úì Recommended Actions</div>
        <div class="distribution-bar">
          <div class="distribution-label">Actions</div>
          <div class="distribution-chart" id="actionChart">
            <div class="distribution-segment segment-accept" style="width: 0%"></div>
            <div class="distribution-segment segment-caution" style="width: 0%"></div>
            <div class="distribution-segment segment-review" style="width: 0%"></div>
            <div class="distribution-segment segment-revise" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="distribution-section">
        <div class="distribution-title">üìù Recent Activity</div>
        <div id="recentPatterns" style="font-size: 12px; color: #7f8c8d;">
          <p style="padding: 12px 0;">No analyses yet. Ask a question to get started!</p>
        </div>
      </div>

      <!-- Actions -->
      <div class="action-buttons">
        <button class="small-btn" onclick="exportData()">üì• Export Data</button>
        <button class="small-btn" onclick="clearAnalytics()">üóëÔ∏è Clear</button>
      </div>

      <div class="info-box">
        üí° All validation patterns are stored locally in your browser's localStorage. No data is sent to external servers.
      </div>
    </div>
  </div>

  <!-- Smart Intelligence Display Component (embedded) -->
  <template id="intelligenceTemplate">
    <div class="smart-intelligence-widget" style="margin: 12px 0;">
      <div class="si-header" onclick="this.nextElementSibling.classList.toggle('collapsed')">
        <div class="si-title">
          <span class="si-toggle-icon">‚ñº</span>
          üß† Smart Intelligence
        </div>
        <div class="confidence-badge" id="confidenceBadge">
          <span class="confidence-dot"></span>
          <span id="confidenceScore">--</span>/100
        </div>
      </div>
      <div class="si-content">
        <div class="si-action" id="actionSection">
          <div class="si-action-label">Recommended Action</div>
          <div class="si-action-text" id="actionText">Loading...</div>
          <div class="si-action-rationale" id="actionRationale"></div>
        </div>
      </div>
    </div>
  </template>

  <script src="js/smart-intelligence-integration.js"></script>
  <style>
    /* Embedded smart intelligence styles */
    .smart-intelligence-widget {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px;
      border-left: 4px solid #667eea;
      font-size: 13px;
    }

    .si-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .si-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      color: #2c3e50;
    }

    .si-toggle-icon {
      display: inline-block;
      transition: transform 0.2s;
    }

    .si-content.collapsed {
      display: none;
    }

    .si-action {
      background: white;
      padding: 8px;
      border-radius: 6px;
      border-left: 3px solid #667eea;
      margin-top: 8px;
    }

    .si-action.accept {
      border-left-color: #27ae60;
      background: #f0fdf4;
    }

    .si-action.caution {
      border-left-color: #f39c12;
      background: #fffbf0;
    }

    .si-action.review {
      border-left-color: #e74c3c;
      background: #fdf5f3;
    }

    .si-action-label {
      font-size: 11px;
      color: #95a5a6;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .si-action-text {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 4px;
    }

    .si-action-rationale {
      font-size: 12px;
      color: #7f8c8d;
    }

    .confidence-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      background: white;
      border: 1px solid #e0e0e0;
    }

    .confidence-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
  </style>

  <script>
    /**
     * Smart Intelligence Chat Integration Demo
     */

    const siIntegration = new SmartIntelligenceIntegration();

    async function askQuestion() {
      const input = document.getElementById('questionInput');
      const question = input.value.trim();

      if (!question) return;

      // Add user message
      addMessage(question, 'user');
      input.value = '';

      // Simulate bot thinking
      const botMessageEl = addMessage('Thinking...', 'bot');

      // Get response (simulated for demo)
      const botResponse = generateDemoResponse(question);
      botMessageEl.querySelector('.message-content').textContent = botResponse;

      // Validate with smart intelligence
      await validateAndDisplay(question, botResponse, botMessageEl);

      // Update analytics
      updateAnalytics();
    }

    function addMessage(text, sender) {
      const messages = document.getElementById('messages');
      const messageEl = document.createElement('div');
      messageEl.className = `message ${sender}`;
      messageEl.innerHTML = `<div class="message-content">${escapeHtml(text)}</div>`;
      messages.appendChild(messageEl);
      messages.scrollTop = messages.scrollHeight;
      return messageEl;
    }

    async function validateAndDisplay(question, response, messageEl) {
      const result = await siIntegration.validateResponse(question, response);

      if (!result.ok || !result.intelligenceReport) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'info-box error';
        errorDiv.textContent = '‚ö†Ô∏è Could not validate response: ' + (result.error || 'Unknown error');
        messageEl.appendChild(errorDiv);
        return;
      }

      // Create intelligence widget
      const template = document.getElementById('intelligenceTemplate');
      const widgetEl = template.content.cloneNode(true);

      // Update with real data
      const report = result.intelligenceReport;
      const final = report.finalAssessment;

      // Update confidence
      const badge = widgetEl.querySelector('.confidence-badge');
      const score = widgetEl.querySelector('#confidenceScore');
      const dot = widgetEl.querySelector('.confidence-dot');

      score.textContent = Math.round(final.confidenceScore);
      const bracket = final.confidenceBracket.toLowerCase();
      badge.classList.add(bracket);

      // Update action
      const action = widgetEl.querySelector('#actionSection');
      const actionText = widgetEl.querySelector('#actionText');
      const actionRationale = widgetEl.querySelector('#actionRationale');

      const actionMap = {
        'accept': { emoji: '‚úì', class: 'accept' },
        'use with caution': { emoji: '‚ö†', class: 'caution' },
        'review': { emoji: 'üîç', class: 'review' },
        'revise': { emoji: '‚ùå', class: 'revise' }
      };

      const actionConfig = actionMap[final.recommendedAction.toLowerCase()] || actionMap['review'];
      action.classList.add(actionConfig.class);
      actionText.textContent = `${actionConfig.emoji} ${final.recommendedAction}`;
      actionRationale.textContent = final.actionRationale || '';

      messageEl.appendChild(widgetEl);
    }

    function generateDemoResponse(question) {
      const responses = {
        'api': 'To create a REST API with Node.js, use Express.js framework. Start with npm init, install express, and define routes using app.get/post/put/delete methods.',
        'python': 'For Python web development, Django and FastAPI are popular choices. Django provides a full framework with ORM, while FastAPI is lightweight and modern.',
        'database': 'Choose SQL databases like PostgreSQL or MySQL for structured data, NoSQL like MongoDB for flexible schemas, or Redis for caching.',
        'javascript': 'JavaScript runs on both client and server. Use React/Vue for frontend, Node.js for backend, and TypeScript for type safety.',
        'default': 'That is an interesting question. The answer depends on your specific requirements and use case.'
      };

      for (const [key, response] of Object.entries(responses)) {
        if (question.toLowerCase().includes(key)) {
          return response;
        }
      }

      return responses.default;
    }

    function updateAnalytics() {
      const summary = siIntegration.getAnalyticsSummary();
      if (!summary) return;

      // Update stats
      document.getElementById('totalAnalyses').textContent = summary.totalValidations;
      document.getElementById('avgConfidence').textContent = summary.averageConfidence;
      document.getElementById('avgInsights').textContent = summary.averageInsights.toFixed(1);
      document.getElementById('avgIssues').textContent = summary.averageIssues.toFixed(1);

      // Update confidence distribution
      const confChart = document.getElementById('confidenceChart');
      const confTotal = summary.totalValidations;
      confChart.innerHTML = `
        <div class="distribution-segment segment-critical" style="width: ${(summary.confidenceDistribution.critical / confTotal) * 100}%">${summary.confidenceDistribution.critical}</div>
        <div class="distribution-segment segment-high" style="width: ${(summary.confidenceDistribution.high / confTotal) * 100}%">${summary.confidenceDistribution.high}</div>
        <div class="distribution-segment segment-moderate" style="width: ${(summary.confidenceDistribution.moderate / confTotal) * 100}%">${summary.confidenceDistribution.moderate}</div>
        <div class="distribution-segment segment-low" style="width: ${(summary.confidenceDistribution.low / confTotal) * 100}%">${summary.confidenceDistribution.low}</div>
      `;

      // Update action distribution
      const actionChart = document.getElementById('actionChart');
      actionChart.innerHTML = `
        <div class="distribution-segment segment-accept" style="width: ${(summary.actionDistribution.accept / confTotal) * 100}%">${summary.actionDistribution.accept}</div>
        <div class="distribution-segment segment-caution" style="width: ${(summary.actionDistribution.caution / confTotal) * 100}%">${summary.actionDistribution.caution}</div>
        <div class="distribution-segment segment-review" style="width: ${(summary.actionDistribution.review / confTotal) * 100}%">${summary.actionDistribution.review}</div>
        <div class="distribution-segment segment-revise" style="width: ${(summary.actionDistribution.revise / confTotal) * 100}%">${summary.actionDistribution.revise}</div>
      `;

      // Update recent patterns
      const recent = document.getElementById('recentPatterns');
      if (summary.recentPatterns.length > 0) {
        recent.innerHTML = summary.recentPatterns
          .map(p => `
            <div style="padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
              <strong>${p.confidenceBracket}</strong> - ${p.recommendedAction}
              <br><small style="color: #95a5a6;">${new Date(p.timestamp).toLocaleTimeString()}</small>
            </div>
          `)
          .join('');
      }
    }

    function exportData() {
      const json = siIntegration.exportPatterns();
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `smart-intelligence-patterns-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
    }

    function clearAnalytics() {
      if (confirm('Clear all validation patterns?')) {
        siIntegration.clearPatterns();
        updateAnalytics();
      }
    }

    function handleKeypress(event) {
      if (event.key === 'Enter') {
        askQuestion();
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Initial load
    updateAnalytics();
  </script>
</body>
</html>
