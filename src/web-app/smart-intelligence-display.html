<!DOCTYPE html>
<!-- @version 2.1.28 -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Intelligence Display Component</title>
  <style>
    /* Smart Intelligence Widget Styles */
    .smart-intelligence-widget {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      border-left: 4px solid #667eea;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .smart-intelligence-widget.compact {
      padding: 12px;
      margin: 8px 0;
    }

    /* Header Section */
    .si-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      cursor: pointer;
      user-select: none;
    }

    .si-title {
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .si-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
    }

    .si-toggle-icon.collapsed {
      transform: rotate(-90deg);
    }

    /* Confidence Score Badge */
    .confidence-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      background: white;
      border: 2px solid;
    }

    .confidence-badge.critical {
      border-color: #27ae60;
      color: #27ae60;
      background: #f0fdf4;
    }

    .confidence-badge.high {
      border-color: #3498db;
      color: #3498db;
      background: #f0f7ff;
    }

    .confidence-badge.moderate {
      border-color: #f39c12;
      color: #f39c12;
      background: #fffbf0;
    }

    .confidence-badge.low {
      border-color: #e74c3c;
      color: #e74c3c;
      background: #fdf5f3;
    }

    .confidence-badge.unverified {
      border-color: #95a5a6;
      color: #7f8c8d;
      background: #f8f9fa;
    }

    /* Confidence Indicator Dot */
    .confidence-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .confidence-badge.critical .confidence-dot {
      background: #27ae60;
      box-shadow: 0 0 8px rgba(39, 174, 96, 0.5);
    }

    .confidence-badge.high .confidence-dot {
      background: #3498db;
      box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
    }

    .confidence-badge.moderate .confidence-dot {
      background: #f39c12;
      box-shadow: 0 0 8px rgba(243, 156, 18, 0.5);
    }

    .confidence-badge.low .confidence-dot {
      background: #e74c3c;
      box-shadow: 0 0 8px rgba(231, 76, 60, 0.5);
    }

    /* Content Section */
    .si-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .si-content.collapsed {
      display: none;
    }

    /* Action Recommendation */
    .si-action {
      background: white;
      padding: 12px;
      border-radius: 8px;
      border-left: 3px solid #667eea;
    }

    .si-action.accept {
      border-left-color: #27ae60;
      background: #f0fdf4;
    }

    .si-action.caution {
      border-left-color: #f39c12;
      background: #fffbf0;
    }

    .si-action.review {
      border-left-color: #e74c3c;
      background: #fdf5f3;
    }

    .si-action.revise {
      border-left-color: #c0392b;
      background: #fdf2f2;
    }

    .si-action-label {
      font-size: 12px;
      font-weight: 600;
      color: #7f8c8d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .si-action-text {
      font-size: 14px;
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 6px;
    }

    .si-action-rationale {
      font-size: 12px;
      color: #7f8c8d;
      line-height: 1.4;
    }

    /* Grid Layout for Insights */
    .si-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .si-grid.two-col {
      grid-template-columns: repeat(2, 1fr);
    }

    .si-grid.single {
      grid-template-columns: 1fr;
    }

    /* Info Card */
    .si-card {
      background: white;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .si-card h4 {
      font-size: 12px;
      font-weight: 600;
      color: #7f8c8d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .si-card p {
      font-size: 13px;
      color: #2c3e50;
      line-height: 1.4;
    }

    /* Insights List */
    .si-insights {
      background: white;
      border-radius: 8px;
      padding: 12px;
    }

    .si-insights h4 {
      font-size: 12px;
      font-weight: 600;
      color: #7f8c8d;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .si-insight-item {
      font-size: 13px;
      color: #2c3e50;
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
      line-height: 1.4;
    }

    .si-insight-item:before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #667eea;
      font-weight: bold;
    }

    /* Gaps/Issues List */
    .si-gaps {
      background: #fff5f5;
      border-radius: 8px;
      padding: 12px;
      border-left: 3px solid #e74c3c;
    }

    .si-gaps h4 {
      font-size: 12px;
      font-weight: 600;
      color: #c0392b;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .si-gap-item {
      font-size: 13px;
      color: #2c3e50;
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
      line-height: 1.4;
    }

    .si-gap-item:before {
      content: '‚ö†';
      position: absolute;
      left: 0;
      color: #e74c3c;
    }

    /* Next Steps */
    .si-next-steps {
      background: white;
      border-radius: 8px;
      padding: 12px;
      border-left: 3px solid #3498db;
    }

    .si-next-steps h4 {
      font-size: 12px;
      font-weight: 600;
      color: #2c3e50;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .si-step-item {
      font-size: 13px;
      color: #2c3e50;
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
      line-height: 1.4;
    }

    .si-step-item:before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: #3498db;
      font-weight: bold;
    }

    /* Metadata Bar */
    .si-metadata {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 11px;
      color: #95a5a6;
      padding-top: 8px;
      border-top: 1px solid #ecf0f1;
      margin-top: 8px;
    }

    .si-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Expand/Collapse Details */
    .si-section {
      margin-bottom: 12px;
    }

    .si-section-header {
      font-size: 12px;
      font-weight: 600;
      color: #7f8c8d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .si-section-header:hover {
      color: #2c3e50;
    }

    .si-section-toggle {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 10px;
    }

    .si-section-toggle.collapsed {
      transform: rotate(-90deg);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .si-grid {
        grid-template-columns: 1fr;
      }

      .si-grid.two-col {
        grid-template-columns: 1fr;
      }

      .confidence-badge {
        font-size: 12px;
      }

      .si-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .smart-intelligence-widget {
      animation: fadeIn 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="smart-intelligence-widget">
    <div class="si-header" onclick="toggleCollapse(this)">
      <div class="si-title">
        <span class="si-toggle-icon">‚ñº</span>
        üß† Smart Intelligence Analysis
      </div>
      <div class="confidence-badge critical" id="confidenceBadge">
        <span class="confidence-dot"></span>
        <span id="confidenceScore">85</span>/100
      </div>
    </div>

    <div class="si-content" id="siContent">
      <!-- Recommended Action -->
      <div class="si-action accept" id="actionSection">
        <div class="si-action-label">Recommended Action</div>
        <div class="si-action-text" id="actionText">‚úì Accept - High confidence response</div>
        <div class="si-action-rationale" id="actionRationale">
          Response is verified across multiple providers with strong consensus
        </div>
      </div>

      <!-- Key Findings -->
      <div class="si-section">
        <div class="si-section-header">
          <span class="si-section-toggle">‚ñº</span>
          Key Findings
        </div>
        <div class="si-insights" id="keyFindings">
          <div class="si-insight-item">Strong consensus across providers</div>
          <div class="si-insight-item">Technical content verified</div>
          <div class="si-insight-item">No critical gaps identified</div>
        </div>
      </div>

      <!-- Insights -->
      <div class="si-section">
        <div class="si-section-header">
          <span class="si-section-toggle">‚ñº</span>
          Insights Extracted
        </div>
        <div class="si-insights" id="insightsSection" style="display: none;">
          <div class="si-insight-item">Consensus strength: 3 points agreed upon</div>
          <div class="si-insight-item">Provider ranking: Strong agreement</div>
        </div>
      </div>

      <!-- Gaps/Issues -->
      <div class="si-section" id="gapsSection" style="display: none;">
        <div class="si-section-header">
          <span class="si-section-toggle">‚ñº</span>
          Gaps & Issues
        </div>
        <div class="si-gaps" id="gapsList">
          <div class="si-gap-item">Follow-up clarification needed on performance implications</div>
        </div>
      </div>

      <!-- Next Steps -->
      <div class="si-section">
        <div class="si-section-header">
          <span class="si-section-toggle">‚ñº</span>
          Recommended Next Steps
        </div>
        <div class="si-next-steps" id="nextStepsSection" style="display: none;">
          <div class="si-step-item">Verify implementation details</div>
          <div class="si-step-item">Test response in context</div>
        </div>
      </div>

      <!-- Metadata -->
      <div class="si-metadata">
        <div class="si-meta-item">
          <span>üìä</span>
          <span>Verification: <strong id="verificationStatus">Verified</strong></span>
        </div>
        <div class="si-meta-item">
          <span>‚è±Ô∏è</span>
          <span>Analyzed: <strong id="timestamp">just now</strong></span>
        </div>
        <div class="si-meta-item">
          <span>üîÑ</span>
          <span>Pipeline: <strong id="pipelineStages">4 stages</strong></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * Smart Intelligence Widget Controller
     * Manages display, state, and interactions for smart intelligence results
     */

    class SmartIntelligenceWidget {
      constructor(elementId = 'smart-intelligence-widget') {
        this.element = document.querySelector('[class*="smart-intelligence-widget"]');
        this.isCollapsed = false;
      }

      /**
       * Display full intelligence report
       */
      displayReport(report) {
        const final = report.finalAssessment;
        const analysis = report.analysis;

        // Update confidence score
        this.updateConfidence(final.confidenceScore, final.confidenceBracket);

        // Update action recommendation
        this.updateAction(final.recommendedAction, final.actionRationale);

        // Update key findings
        this.updateFindings(final.keyFindings);

        // Update gaps if any
        if (final.criticalIssues && final.criticalIssues.length > 0) {
          this.updateGaps(final.criticalIssues);
        }

        // Update next steps
        if (final.nextActions && final.nextActions.length > 0) {
          this.updateNextSteps(final.nextActions);
        }

        // Update insights if from analysis
        if (analysis && analysis.insights) {
          this.updateInsights(analysis.insights);
        }

        // Update metadata
        this.updateMetadata(report);
      }

      /**
       * Update confidence badge
       */
      updateConfidence(score, bracket) {
        const badge = document.getElementById('confidenceBadge');
        const scoreEl = document.getElementById('confidenceScore');

        // Remove old bracket class
        badge.classList.remove('critical', 'high', 'moderate', 'low', 'unverified');

        // Add new bracket class
        const bracketClass = bracket.toLowerCase();
        badge.classList.add(bracketClass);

        // Update score
        scoreEl.textContent = Math.round(score);
      }

      /**
       * Update action recommendation
       */
      updateAction(action, rationale) {
        const section = document.getElementById('actionSection');
        const text = document.getElementById('actionText');
        const reason = document.getElementById('actionRationale');

        // Map action to class and emoji
        const actionMap = {
          'Accept': { emoji: '‚úì', class: 'accept' },
          'Use With Caution': { emoji: '‚ö†', class: 'caution' },
          'Review': { emoji: 'üîç', class: 'review' },
          'Revise': { emoji: '‚ùå', class: 'revise' }
        };

        const config = actionMap[action] || actionMap['Review'];

        // Update section styling
        section.classList.remove('accept', 'caution', 'review', 'revise');
        section.classList.add(config.class);

        // Update text
        text.textContent = `${config.emoji} ${action}`;
        reason.textContent = rationale || 'No rationale provided';
      }

      /**
       * Update key findings
       */
      updateFindings(findings) {
        const container = document.getElementById('keyFindings');
        if (!findings || findings.length === 0) return;

        container.innerHTML = findings
          .map(f => `<div class="si-insight-item">${this.sanitize(f)}</div>`)
          .join('');
      }

      /**
       * Update gaps and issues
       */
      updateGaps(gaps) {
        const section = document.getElementById('gapsSection');
        const container = document.getElementById('gapsList');

        if (gaps.length === 0) {
          section.style.display = 'none';
          return;
        }

        section.style.display = 'block';
        container.innerHTML = gaps
          .map(g => `<div class="si-gap-item">${this.sanitize(g)}</div>`)
          .join('');
      }

      /**
       * Update next steps
       */
      updateNextSteps(steps) {
        const section = document.getElementById('nextStepsSection');
        const container = section.previousElementSibling;

        if (!steps || steps.length === 0) {
          section.style.display = 'none';
          return;
        }

        section.style.display = 'block';
        container.innerHTML = steps
          .map(s => {
            const text = typeof s === 'string' ? s : s.task || s.text || s.action;
            return `<div class="si-step-item">${this.sanitize(text)}</div>`;
          })
          .join('');
      }

      /**
       * Update extracted insights
       */
      updateInsights(insights) {
        const section = document.getElementById('insightsSection');
        if (!insights || insights.length === 0) {
          section.style.display = 'none';
          return;
        }

        section.style.display = 'block';
        section.parentElement.querySelector('.si-insights').innerHTML = insights
          .slice(0, 3)
          .map(i => {
            const text = i.description || i.text || i;
            return `<div class="si-insight-item">${this.sanitize(text)}</div>`;
          })
          .join('');
      }

      /**
       * Update metadata
       */
      updateMetadata(report) {
        const status = document.getElementById('verificationStatus');
        const timestamp = document.getElementById('timestamp');
        const stages = document.getElementById('pipelineStages');

        if (report.finalAssessment) {
          status.textContent = report.finalAssessment.verificationStatus || 'Pending';
        }

        timestamp.textContent = this.formatTime(new Date(report.context?.timestamp));
        
        if (report.metadata?.stagesExecuted) {
          stages.textContent = `${report.metadata.stagesExecuted.length} stages`;
        }
      }

      /**
       * Format timestamp
       */
      formatTime(date) {
        const now = new Date();
        const diff = now - date;
        const mins = Math.floor(diff / 60000);

        if (mins === 0) return 'just now';
        if (mins < 60) return `${mins}m ago`;
        if (mins < 1440) return `${Math.floor(mins / 60)}h ago`;
        return date.toLocaleDateString();
      }

      /**
       * Sanitize text for security
       */
      sanitize(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      /**
       * Compact display mode
       */
      setCompactMode(compact = true) {
        const widget = this.element;
        if (compact) {
          widget.classList.add('compact');
        } else {
          widget.classList.remove('compact');
        }
      }

      /**
       * Toggle collapsed state
       */
      toggleCollapse() {
        this.isCollapsed = !this.isCollapsed;
        const content = document.getElementById('siContent');
        const icon = document.querySelector('.si-toggle-icon');

        if (this.isCollapsed) {
          content.classList.add('collapsed');
          icon.classList.add('collapsed');
        } else {
          content.classList.remove('collapsed');
          icon.classList.remove('collapsed');
        }
      }
    }

    // Helper function for onclick
    function toggleCollapse(headerElement) {
      const widget = headerElement.closest('.smart-intelligence-widget');
      const content = widget.querySelector('.si-content');
      const icon = widget.querySelector('.si-toggle-icon');

      content.classList.toggle('collapsed');
      icon.classList.toggle('collapsed');
    }

    // Initialize widget
    const widget = new SmartIntelligenceWidget();

    // Example: Display sample report
    function displaySampleReport() {
      const sampleReport = {
        context: {
          question: 'How do I create a REST API?',
          timestamp: new Date().toISOString()
        },
        analysis: {
          insights: [
            'Strong consensus on using Express.js',
            'Providers agree on REST principles',
            'Error handling is emphasized'
          ]
        },
        finalAssessment: {
          confidenceScore: 85,
          confidenceBracket: 'High',
          verificationStatus: 'verified',
          recommendedAction: 'Accept',
          actionRationale: 'High consensus and verified technical content',
          keyFindings: [
            'Multiple providers agree on Express.js approach',
            'Technical content validated against npm/GitHub',
            'Clear implementation examples provided'
          ],
          criticalIssues: [],
          nextActions: [
            'Implement the suggested approach',
            'Test endpoints with provided examples',
            'Consider security best practices'
          ]
        },
        metadata: {
          stagesExecuted: ['cross-validation', 'analysis', 'technical-validation', 'synthesis']
        }
      };

      widget.displayReport(sampleReport);
    }

    // Optional: Auto-load sample on page load
    // displaySampleReport();
  </script>
</body>
</html>
