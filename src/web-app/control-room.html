<!doctype html>
<!-- @version 2.1.342 -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tooloo Synapsys // Control Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #030712;
        color: #e2e8f0;
      }
      .mono {
        font-family: "JetBrains Mono", monospace;
      }
      .glass {
        background: rgba(17, 24, 39, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .glass-hover:hover {
        background: rgba(17, 24, 39, 0.9);
        border-color: rgba(6, 182, 212, 0.3);
      }
      .glow-text {
        text-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      .tab-btn.active {
        border-bottom-color: #06b6d4;
        color: #22d3ee;
      }
    </style>
  </head>
  <body class="h-screen w-screen overflow-hidden flex text-sm">
    <!-- SIDEBAR -->
    <aside class="w-64 flex flex-col border-r border-white/10 bg-gray-900/50">
      <div class="p-4 border-b border-white/10 flex items-center gap-3">
        <div
          class="w-8 h-8 rounded bg-cyan-500/20 border border-cyan-500 flex items-center justify-center text-cyan-400 font-bold"
        >
          T
        </div>
        <div>
          <h1 class="font-bold tracking-tight">TooLoo.ai</h1>
          <p class="text-xs text-gray-500 mono system-version">Synapsys v2.4</p>
        </div>
      </div>

      <nav class="flex-1 overflow-y-auto py-4">
        <div
          class="px-4 mb-2 text-xs font-bold text-gray-600 uppercase tracking-wider"
        >
          Core
        </div>
        <a
          href="index.html"
          class="block px-4 py-2 border-l-2 border-transparent hover:bg-white/5 text-gray-400"
          >Home</a
        >
        <a
          href="chat-pro-v2.html"
          class="block px-4 py-2 border-l-2 border-transparent hover:bg-white/5 text-gray-400"
          >Chat Pro</a
        >
        <a
          href="projects.html"
          class="block px-4 py-2 border-l-2 border-transparent hover:bg-white/5 text-gray-400"
          >Projects</a
        >

        <div
          class="px-4 mt-6 mb-2 text-xs font-bold text-gray-600 uppercase tracking-wider"
        >
          Tools
        </div>
        <a
          href="visuals.html"
          class="block px-4 py-2 border-l-2 border-transparent hover:bg-white/5 text-gray-400"
          >Visual Designer</a
        >
        <a
          href="control-room.html"
          class="block px-4 py-2 border-l-2 border-cyan-500 bg-cyan-500/10 text-cyan-300"
          >Control Room</a
        >
        <a
          href="system-awareness.html"
          class="block px-4 py-2 border-l-2 border-transparent hover:bg-white/5 text-gray-400"
          >System Awareness</a
        >
      </nav>

      <div class="p-4 border-t border-white/10">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs text-gray-500">System Load</span>
          <span class="text-xs text-emerald-400 mono" id="systemLoad">--%</span>
        </div>
        <div class="h-1 w-full bg-gray-800 rounded-full overflow-hidden">
          <div
            class="h-full bg-cyan-500 w-0 transition-all duration-500"
            id="loadBar"
          ></div>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col relative overflow-y-auto">
      <!-- Header -->
      <header
        class="h-14 border-b border-white/10 flex items-center justify-between px-6 bg-gray-900/30 sticky top-0 backdrop-blur z-10"
      >
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
          <span class="mono text-xs text-red-400"
            >CONTROL ROOM // RESTRICTED</span
          >
        </div>
        <div class="flex gap-4 items-center">
          <button
            onclick="restartSystem()"
            class="px-3 py-1.5 bg-red-900/30 hover:bg-red-900/50 text-red-400 border border-red-500/30 rounded text-xs font-bold transition"
          >
            RESTART SYSTEM
          </button>
        </div>
      </header>

      <div class="p-8 max-w-7xl mx-auto w-full space-y-6">
        <!-- Tabs -->
        <div class="flex border-b border-white/10 mb-6">
          <button
            class="tab-btn active px-6 py-3 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white transition"
            onclick="switchTab('providers')"
          >
            Providers
          </button>
          <button
            class="tab-btn px-6 py-3 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white transition"
            onclick="switchTab('github')"
          >
            GitHub
          </button>
          <button
            class="tab-btn px-6 py-3 text-sm font-medium text-gray-400 border-b-2 border-transparent hover:text-white transition"
            onclick="switchTab('system')"
          >
            System Internals
          </button>
        </div>

        <!-- Content Area -->
        <div id="tab-content" class="space-y-6">
          <!-- Default: Providers -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="glass p-6 rounded-lg">
              <h3 class="text-lg font-bold text-white mb-4">OpenAI</h3>
              <div class="flex items-center justify-between mb-2">
                <span class="text-gray-400 text-xs">Status</span>
                <span class="text-emerald-400 text-xs mono">OPERATIONAL</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-400 text-xs">Latency</span>
                <span class="text-white text-xs mono">124ms</span>
              </div>
            </div>
            <div class="glass p-6 rounded-lg border-cyan-500/30">
              <h3 class="text-lg font-bold text-cyan-400 mb-4">
                Google Gemini
              </h3>
              <div class="flex items-center justify-between mb-2">
                <span class="text-gray-400 text-xs">Status</span>
                <span class="text-emerald-400 text-xs mono">OPERATIONAL</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-400 text-xs">Latency</span>
                <span class="text-white text-xs mono">89ms</span>
              </div>
            </div>
            <div class="glass p-6 rounded-lg">
              <h3 class="text-lg font-bold text-white mb-4">Anthropic</h3>
              <div class="flex items-center justify-between mb-2">
                <span class="text-gray-400 text-xs">Status</span>
                <span class="text-emerald-400 text-xs mono">OPERATIONAL</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-400 text-xs">Latency</span>
                <span class="text-white text-xs mono">156ms</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      const API_BASE = window.location.origin;

      function switchTab(tabName) {
        document
          .querySelectorAll(".tab-btn")
          .forEach((b) => b.classList.remove("active"));
        event.target.classList.add("active");

        // Simple tab switching logic
        if (tabName === "system") {
          fetchSystemStatus();
        } else {
          fetchProviderStatus();
        }
      }

      async function fetchProviderStatus() {
        const content = document.getElementById("tab-content");
        content.innerHTML =
          '<div class="text-center text-gray-500">Loading provider status...</div>';

        try {
          const res = await fetch(`${API_BASE}/api/v1/providers/status`);
          const json = await res.json();
          // Handle StandardResponse: { ok: true, data: { ... }, version: ... }
          const status = json.data || json;

          if (!status.available) {
            content.innerHTML =
              '<div class="text-red-400">Failed to load provider status (Invalid Data)</div>';
            console.error("Invalid provider status data:", json);
            return;
          }

          let html = '<div class="grid grid-cols-1 md:grid-cols-3 gap-4">';
          status.available.forEach((p) => {
            const isOperational =
              p.status === "Ready" || p.status === "Operational";
            const color = isOperational ? "emerald" : "yellow";
            const borderColor =
              p.id === status.active
                ? "border-cyan-500/50"
                : "border-transparent";

            html += `
                <div class="glass p-6 rounded-lg border ${borderColor}">
                  <h3 class="text-lg font-bold text-white mb-4">${p.name}</h3>
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-gray-400 text-xs">Status</span>
                    <span class="text-${color}-400 text-xs mono uppercase">${p.status}</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-gray-400 text-xs">Latency</span>
                    <span class="text-white text-xs mono">${status.latency || "--"}ms</span>
                  </div>
                </div>`;
          });
          html += "</div>";
          content.innerHTML = html;
        } catch (e) {
          content.innerHTML = `<div class="text-red-400">Error: ${e.message}</div>`;
        }
      }

      async function fetchSystemStatus() {
        const content = document.getElementById("tab-content");
        content.innerHTML =
          '<div class="text-center text-gray-500">Loading system status...</div>';

        try {
          const res = await fetch(`${API_BASE}/api/v1/system/awareness`);
          const data = await res.json();
          const awareness = data.content || data;

          content.innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <h3 class="text-lg font-bold text-white mb-4">System Awareness</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between border-b border-white/10 pb-2">
                            <span class="text-gray-400">Version</span>
                            <span class="text-cyan-400 mono">${awareness.version || "Unknown"}</span>
                        </div>
                        <div class="flex justify-between border-b border-white/10 pb-2">
                            <span class="text-gray-400">Environment</span>
                            <span class="text-white mono">${awareness.environment || "Production"}</span>
                        </div>
                         <div class="mt-4">
                            <h4 class="text-sm font-bold text-gray-300 mb-2">Capabilities</h4>
                            <div class="flex flex-wrap gap-2">
                                ${(awareness.capabilities || []).map((c) => `<span class="px-2 py-1 rounded bg-gray-800 text-xs text-gray-300 border border-white/10">${c}</span>`).join("")}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        } catch (e) {
          content.innerHTML = `<div class="text-red-400">Error: ${e.message}</div>`;
        }
      }

      async function restartSystem() {
        if (confirm("Are you sure you want to restart the Synapsys Core?")) {
          try {
            await fetch(`${API_BASE}/api/v1/system/restart`, {
              method: "POST",
            });
            alert("Restart command sent.");
          } catch (e) {
            alert("Failed to send restart command.");
          }
        }
      }

      // Initial Load
      fetchProviderStatus();
    </script>
    <script src="js/version-sync.js"></script>
  </body>
</html>
