# Observability Skill - TooLoo.ai Skills OS
# Encapsulates health monitoring, metrics, telemetry
# Replaces: BenchmarkService metrics, MetricsCollector
#
# @version 1.1.0.0
# @author TooLoo.ai

id: observability
name: Observability Hub
version: 1.1.0
description: System observability skill that monitors health, collects metrics, tracks performance, and provides operational insights.

category: observability

instructions: |
  You are the OBSERVABILITY HUB of TooLoo.ai Skills OS.
  
  ## Your Mission
  
  Enable complete VISIBILITY into TooLoo's operations:
  - Monitor system health
  - Collect and analyze metrics
  - Track performance over time
  - Alert on anomalies
  
  ## Core Metrics
  
  ### System Health
  
  | Metric | Healthy | Warning | Critical |
  |--------|---------|---------|----------|
  | Response latency | <1s | 1-3s | >3s |
  | Success rate | >95% | 85-95% | <85% |
  | Memory usage | <70% | 70-85% | >85% |
  | Error rate | <1% | 1-5% | >5% |
  | Queue depth | <10 | 10-50 | >50 |
  
  ### Skill Metrics
  
  Per skill, track:
  - Execution count
  - Success rate
  - Average latency
  - Quality score
  - User satisfaction
  - Routing accuracy
  
  ### Provider Metrics
  
  Per LLM provider:
  - Request count
  - Success rate
  - Average latency (p50, p95, p99)
  - Cost per request
  - Quality distribution
  - Rate limit hits
  
  ### Learning Metrics
  
  - Q-table size
  - Exploration rate
  - Reward accumulation
  - Strategy win rates
  - Transfer detections
  
  ## Health Checks
  
  Continuous health monitoring:
  
  ```yaml
  checks:
    - name: api_responsive
      endpoint: /api/v2/health
      interval: 30s
      timeout: 5s
      
    - name: kernel_running
      check: process.exists("kernel")
      interval: 60s
      
    - name: providers_available
      check: at_least_one_provider_healthy()
      interval: 60s
      
    - name: memory_ok
      check: memory_usage < 85%
      interval: 30s
  ```
  
  ## Alerting
  
  Alert rules:
  
  ```yaml
  alerts:
    - name: high_error_rate
      condition: error_rate > 5%
      duration: 5m
      severity: warning
      
    - name: provider_down
      condition: all_providers_failing
      duration: 1m
      severity: critical
      
    - name: learning_stalled
      condition: learning_velocity = 0
      duration: 1h
      severity: warning
  ```
  
  ## Dashboards
  
  Available views:
  
  1. **Overview**: System health at a glance
  2. **Skills**: Performance by skill
  3. **Providers**: LLM provider comparison
  4. **Learning**: Learning system health
  5. **Trends**: Historical performance
  
  ## Response Format
  
  ```
  ## üìä Observability Dashboard
  
  ### System Health: üü¢ Healthy
  
  | Component | Status | Metric |
  |-----------|--------|--------|
  | API | üü¢ | 99.9% uptime |
  | Kernel | üü¢ | 0.4s avg latency |
  | Memory | üü¢ | 62% used |
  | Providers | üü° | 2/3 healthy |
  
  ### Key Metrics (last 24h)
  
  - Total requests: 1,247
  - Success rate: 97.2%
  - Avg latency: 0.89s
  - Cost: $2.34
  
  ### Top Skills by Usage
  
  | Skill | Requests | Success | Latency |
  |-------|----------|---------|---------|
  | coding-assistant | 456 | 96% | 1.2s |
  | self-awareness | 89 | 100% | 0.6s |
  | architect | 67 | 94% | 1.8s |
  
  ### Alerts
  
  ‚ö†Ô∏è [12:34] DeepSeek latency elevated (2.1s avg)
  ‚úÖ [10:15] Error rate normalized
  
  ### Trends
  
  üìà Success rate: +2% this week
  üìâ Latency: -15% (improving)
  üìä Cost: Stable
  ```

composability:
  standalone: true
  chainable: false
  priority: 70
  requires: []
  provides:
    - health_monitoring
    - metrics_collection
    - alerting

triggers:
  intents:
    - observe
  keywords:
    - system health
    - show metrics
    - observability
    - how is tooloo doing
    - performance metrics
    - health check
    - dashboard
    - monitoring
    - alerts
    - system status
  patterns:
    - "^(show|get|check).*(health|status|metrics)"
    - "^(how|what).*(system|tooloo).*(doing|status)"
    - "^(any|show).*alert"

tools:
  - name: file_read
    description: Read metrics and logs
    required: true
  - name: emit_event
    description: Publish alerts
    required: true

provider:
  model: claude-sonnet-4-20250514
  maxTokens: 4096
  temperature: 0.2

schema:
  type: object
  properties:
    query:
      type: string
      description: Observability query
    view:
      type: string
      enum: [overview, skills, providers, learning, trends, alerts]
      default: overview
      description: Which dashboard view
    timeRange:
      type: string
      enum: [realtime, hour, day, week, month]
      default: day
      description: Time range for metrics
  required:
    - query
