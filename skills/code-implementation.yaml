# TooLoo.ai Skills OS - Safe Code Implementation Skill
# Allows TooLoo to implement its own code suggestions safely
# Version: 1.0.0

id: code-implementation
name: Safe Code Implementation
version: "1.0.0"
description: >
  Safely implements code suggestions generated by TooLoo.ai.
  Uses a 6-stage pipeline: STAGE → VERIFY → TEST → APPROVE → DEPLOY → VALIDATE.
  Supports automatic rollback on failure.

category: meta
author: TooLoo.ai

# Intent routing
keywords:
  - implement
  - create file
  - write code
  - deploy code
  - self-implement
  - generate file
  - build component

# Input schema
schema:
  type: object
  properties:
    files:
      type: array
      description: Files to create or modify
      items:
        type: object
        properties:
          path:
            type: string
            description: Relative path from workspace root
          content:
            type: string
            description: File content to write
          action:
            type: string
            enum: [create, modify, delete]
            description: Action to perform
        required:
          - path
          - content
          - action
    description:
      type: string
      description: Description of what this implementation does
    riskLevel:
      type: string
      enum: [low, medium, high, critical]
      description: Risk level for approval workflow
    autoApprove:
      type: boolean
      description: Whether to auto-approve if risk is low
    runTests:
      type: boolean
      description: Whether to run tests before deployment
    testPatterns:
      type: array
      items:
        type: string
      description: Test file patterns to run
  required:
    - files
    - description

# Output schema
outputSchema:
  type: object
  properties:
    success:
      type: boolean
    implementationId:
      type: string
    pipeline:
      type: object
      properties:
        staged:
          type: boolean
        verified:
          type: boolean
        tested:
          type: boolean
        approved:
          type: boolean
        deployed:
          type: boolean
        validated:
          type: boolean
    filesCreated:
      type: array
      items:
        type: string
    errors:
      type: array
      items:
        type: string
    rollbackAvailable:
      type: boolean

# LLM instructions
instructions: |
  You are the Safe Code Implementation skill for TooLoo.ai.
  
  ## Your Role
  You implement code suggestions safely through a verified pipeline.
  
  ## Pipeline Stages
  1. **STAGE**: Write files to temp/staging directory
  2. **VERIFY**: Run TypeScript compile, ESLint, syntax checks
  3. **TEST**: Run relevant tests (if enabled)
  4. **APPROVE**: Get human approval (or auto-approve for low-risk)
  5. **DEPLOY**: Move from staging to actual location
  6. **VALIDATE**: Verify deployment worked correctly
  
  ## Risk Levels
  - **low**: Config files, documentation, tests
  - **medium**: New components, utilities, skills
  - **high**: Kernel modifications, API changes
  - **critical**: Security-related, authentication, data handling
  
  ## Auto-Approval Rules
  - Low risk + autoApprove=true → Auto-approve
  - Medium risk → Requires explicit approval flag
  - High/Critical risk → Always requires human approval
  
  ## Safety Checks
  - Never modify protected paths (node_modules, .git, dist)
  - Always create backups before modifying existing files
  - Validate file paths are within workspace
  - Check for syntax errors before deployment
  
  ## Rollback
  If deployment fails:
  1. Restore backed-up files
  2. Remove newly created files
  3. Report what was rolled back

# Tools available
tools:
  - name: file_write
    description: Write files to staging or deployment location
    required: true
  - name: file_read
    description: Read existing files for backup
    required: true
  - name: terminal_execute
    description: Run verification and test commands
    required: true
  - name: skill_execute
    description: Execute other skills if needed
    required: false

# Context
context:
  memoryScope: session
  ragSources:
    - codebase
  maxTokens: 8000

# Metadata
metadata:
  phase: 11
  priority: critical
  selfModifying: true
  requiresApproval: true
  auditLogging: true
