<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TooLoo Design Suite</title>
  <meta name="description" content="World‑class design system builder for TooLoo.ai" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;600;700&family=Poppins:wght@400;600;800&family=Plus+Jakarta+Sans:wght@400;600;800&family=Cormorant+Garamond:wght@400;600&family=Source+Sans+3:wght@400;600&family=Spectral:wght@400;600&family=Work+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0d10; --surface:#14181e; --text:#e6e9ee; --muted:#96a0af; --brand:#7c5cff; --brandAlt:#00e9b0; --accent:#ffe770; --danger:#ff5c7c;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,0.5);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0a0c10,#0b0d12);color:var(--text);font-family:Inter,system-ui}
    a{color:inherit;text-decoration:none}
    .nav{position:sticky;top:0;z-index:40;display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(16,18,24,0.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,0.08)}
    .wrap{max-width:1240px;margin:0 auto;padding:24px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:10px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,rgba(124,92,255,0.28),rgba(0,233,176,0.28));border-color:transparent}
    .layout{display:grid;grid-template-columns:300px 1fr;gap:16px}
    .panel{background:linear-gradient(180deg,#151a22,#12161d);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius);box-shadow:var(--shadow)}
    .panel h3{margin:0 0 8px;font-size:14px;color:#cfe3ff}
    .sidebar{padding:16px}
    .content{padding:16px}
    .field{display:grid;gap:6px;margin-bottom:10px}
    label{font-size:12px;color:#aeb8c8}
    input[type="color"],input[type="text"],select{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:10px;color:var(--text);padding:8px}
    .tok{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tab{padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);cursor:pointer;font-size:12px}
    .tab.active{background:rgba(124,92,255,0.25);border-color:transparent}
    .preview{padding:16px;display:grid;gap:12px}
    .card{background:linear-gradient(180deg,#151a22,#12161d);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:14px}
    .comp-row{display:flex;gap:10px;flex-wrap:wrap}
    .btn-ui{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.04);cursor:pointer}
    .btn-ui.primary{background:linear-gradient(135deg,rgba(124,92,255,0.28),rgba(0,233,176,0.28));border-color:transparent}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{color:#9fb0c6}
    .footer{font-size:12px;color:#a7b0bf;padding:10px 0}
    @media(max-width:1000px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="nav">
    <div style="display:flex;align-items:center;gap:10px">
      <div style="width:24px;height:24px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--brandAlt))"></div>
      <strong>TooLoo Design Suite</strong>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <a class="btn" href="/knowledge">Knowledge</a>
      <a class="btn" href="/control-room">Control Room</a>
  <button id="exportBtn" class="btn primary">Export</button>
  <button id="brandBoardBtn" class="btn" title="Export Brand Board PDF">Brand Board PDF</button>
    </div>
  </div>
  <main class="wrap layout">
    <aside class="panel sidebar" aria-label="Design controls">
      <div class="tabs" role="tablist">
        <button class="tab active" data-tab="tokens" role="tab" aria-selected="true">Tokens</button>
        <button class="tab" data-tab="palette" role="tab" aria-selected="false">Palette</button>
        <button class="tab" data-tab="type" role="tab" aria-selected="false">Typography</button>
        <button class="tab" data-tab="components" role="tab" aria-selected="false">Components</button>
        <button class="tab" data-tab="a11y" role="tab" aria-selected="false">Accessibility</button>
        <button class="tab" data-tab="presets" role="tab" aria-selected="false">Presets</button>
      </div>
      <div id="panelContent"></div>
    </aside>
    <section class="panel content" aria-live="polite">
      <div class="preview" id="preview">
        <div class="card">
          <div style="font-family: var(--font-display, 'Playfair Display'), serif; font-size:34px; line-height:1.1">Signature Headline</div>
          <div class="muted" style="margin-top:6px">Polished copy that communicates trust and personality.</div>
          <div class="comp-row" style="margin-top:12px">
            <button class="btn-ui">Default</button>
            <button class="btn-ui primary">Primary</button>
            <button class="btn-ui" style="border-color: rgba(255,231,112,0.5)">Accent</button>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <div style="font-weight:700;margin-bottom:8px">Color Swatches</div>
            <div id="swatches" style="display:flex;gap:8px;flex-wrap:wrap"></div>
          </div>
          <div class="card">
            <div style="font-weight:700;margin-bottom:8px">Contrast Check</div>
            <div class="field">
              <label>Foreground</label>
              <input type="color" id="fgPicker" />
            </div>
            <div class="field">
              <label>Background</label>
              <input type="color" id="bgPicker" />
            </div>
            <div id="contrastResult" class="muted"></div>
          </div>
        </div>
        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">Type Scale</div>
          <div id="typeScale" class="muted"></div>
        </div>
        <div class="footer">© <span id="year"></span> TooLoo.ai — Design without compromise.</div>
      </div>
    </section>
  </main>
  <script>
    const $ = (q, el=document)=>el.querySelector(q); const $$ = (q, el=document)=>Array.from(el.querySelectorAll(q));
    const state = {
      tokens: JSON.parse(localStorage.getItem('designTokens')||'null') || {
        brand: '#7c5cff', brandAlt: '#00e9b0', accent: '#ffe770', danger: '#ff5c7c',
        bg: '#0b0d10', surface: '#14181e', text: '#e6e9ee', muted: '#96a0af'
      },
      fonts: JSON.parse(localStorage.getItem('designFonts')||'null') || { display: 'Playfair Display', body: 'Inter' },
      tab: 'tokens'
    };
    function save(){ localStorage.setItem('designTokens', JSON.stringify(state.tokens)); localStorage.setItem('designFonts', JSON.stringify(state.fonts)); }
    function apply(){
      const r = document.documentElement.style;
      r.setProperty('--brand', state.tokens.brand);
      r.setProperty('--brandAlt', state.tokens.brandAlt);
      r.setProperty('--accent', state.tokens.accent);
      r.setProperty('--danger', state.tokens.danger);
      r.setProperty('--bg', state.tokens.bg);
      r.setProperty('--surface', state.tokens.surface);
      r.setProperty('--text', state.tokens.text);
      r.setProperty('--muted', state.tokens.muted);
      r.setProperty('--font-display', state.fonts.display);
      document.body.style.background = `linear-gradient(180deg, ${shade(state.tokens.bg, -4)}, ${state.tokens.bg})`;
      renderSwatches(); renderTypeScale();
    }
    function shade(hex, pct){ const c=parseInt(hex.slice(1),16); let r=(c>>16)&255,g=(c>>8)&255,b=c&255; r=Math.min(255,Math.max(0,r+255*pct/100)); g=Math.min(255,Math.max(0,g+255*pct/100)); b=Math.min(255,Math.max(0, b+255*pct/100)); return `#${(1<<24|r<<16|g<<8|b).toString(16).slice(1)}`; }
    function contrast(fg, bg){
      const L = (c)=>{ c=c/255; return c<=0.03928? c/12.92: ((c+0.055)/1.055)**2.4 };
      const hexToRgb = (h)=>({ r:parseInt(h.slice(1,3),16), g:parseInt(h.slice(3,5),16), b:parseInt(h.slice(5,7),16) });
      const F=hexToRgb(fg), B=hexToRgb(bg);
      const L1=0.2126*L(F.r)+0.7152*L(F.g)+0.0722*L(F.b);
      const L2=0.2126*L(B.r)+0.7152*L(B.g)+0.0722*L(B.b);
      const ratio = (Math.max(L1,L2)+0.05)/(Math.min(L1,L2)+0.05);
      return ratio;
    }
    function renderSwatches(){
      const c = $('#swatches'); c.innerHTML='';
      const keys = Object.keys(state.tokens);
      keys.forEach(k=>{ const d=document.createElement('div'); d.style.width='28px'; d.style.height='28px'; d.style.borderRadius='8px'; d.style.border='1px solid rgba(255,255,255,0.12)'; d.title = `${k}: ${state.tokens[k]}`; d.style.background = state.tokens[k]; c.appendChild(d); });
    }
    function renderTypeScale(){
      const container = $('#typeScale'); container.innerHTML='';
      const sizes = [40,28,22,18,16,14,12];
      sizes.forEach((s,i)=>{ const div=document.createElement('div'); div.style.fontFamily = `var(--font-display, 'Playfair Display'), serif`; div.style.fontSize=s+'px'; div.style.marginBottom='6px'; div.textContent = i===0? 'Display XL — brand moment' : `Text ${s}px`; container.appendChild(div); });
    }
    function renderPanel(){
      const host = $('#panelContent');
      if(state.tab==='tokens'){
        host.innerHTML = `
          <div class='field'><label>Brand</label><input type='color' id='t_brand' value='${state.tokens.brand}'></div>
          <div class='field'><label>Brand Alt</label><input type='color' id='t_brandAlt' value='${state.tokens.brandAlt}'></div>
          <div class='field'><label>Accent</label><input type='color' id='t_accent' value='${state.tokens.accent}'></div>
          <div class='field'><label>Danger</label><input type='color' id='t_danger' value='${state.tokens.danger}'></div>
          <hr style='border-color:rgba(255,255,255,0.08);margin:8px 0'>
          <div class='field'><label>Background</label><input type='color' id='t_bg' value='${state.tokens.bg}'></div>
          <div class='field'><label>Surface</label><input type='color' id='t_surface' value='${state.tokens.surface}'></div>
          <div class='field'><label>Text</label><input type='color' id='t_text' value='${state.tokens.text}'></div>
          <div class='field'><label>Muted</label><input type='color' id='t_muted' value='${state.tokens.muted}'></div>
        `;
        ['brand','brandAlt','accent','danger','bg','surface','text','muted'].forEach(key=>{
          const el = $('#t_'+key); el.addEventListener('input', (e)=>{ state.tokens[key]=e.target.value; save(); apply(); });
        });
      }
      if(state.tab==='palette'){
        host.innerHTML = `
          <div class='field'><label>Generate harmonies</label>
            <select id='harmony'>
              <option value='analogous'>Analogous</option>
              <option value='complementary'>Complementary</option>
              <option value='triad'>Triadic</option>
              <option value='tetrad'>Tetradic</option>
            </select>
          </div>
          <button class='btn' id='genPalette'>Generate</button>
          <div style='margin-top:10px' id='paletteOut' class='muted'></div>
        `;
        $('#genPalette').addEventListener('click', ()=>{
          const h = $('#harmony').value; const base = state.tokens.brand;
          const out = genPalette(base, h);
          $('#paletteOut').textContent = out.join(' ');
        });
      }
      if(state.tab==='type'){
        host.innerHTML = `
          <div class='field'><label>Display font</label>
            <select id='f_display'>
              <option>Playfair Display</option>
              <option>Poppins</option>
              <option>Plus Jakarta Sans</option>
              <option>Cormorant Garamond</option>
              <option>Spectral</option>
            </select>
          </div>
          <div class='field'><label>Body font</label>
            <select id='f_body'>
              <option>Inter</option>
              <option>Source Sans 3</option>
              <option>Work Sans</option>
              <option>Plus Jakarta Sans</option>
            </select>
          </div>
        `;
        $('#f_display').value = state.fonts.display; $('#f_body').value = state.fonts.body;
        $('#f_display').addEventListener('change', (e)=>{ state.fonts.display = e.target.value; save(); apply(); });
        $('#f_body').addEventListener('change', (e)=>{ state.fonts.body = e.target.value; save(); apply(); });
      }
      if(state.tab==='components'){
        host.innerHTML = `
          <div class='muted'>Components pick up tokens automatically. Adjust tokens and typography, then export to code.</div>
          <div style='height:8px'></div>
          <button class='btn' id='peek'>Preview variants</button>
        `;
        $('#peek').addEventListener('click', ()=>{
          alert('Variants preview uses your current tokens. Try changing Brand and Display font, then look at the buttons in the preview.');
        });
      }
      if(state.tab==='a11y'){
        host.innerHTML = `
          <div class='field'><label>Check contrast (AA >= 4.5)</label></div>
          <div class='field'><label>Foreground</label><input type='color' id='c_fg' value='${state.tokens.text}'></div>
          <div class='field'><label>Background</label><input type='color' id='c_bg' value='${state.tokens.bg}'></div>
          <div id='c_out' class='muted'></div>
        `;
        const update=()=>{ const v=contrast($('#c_fg').value,$('#c_bg').value); $('#c_out').textContent = `Contrast: ${v.toFixed(2)} — ${v>=4.5? 'PASS (AA)': 'FAIL'}`; };
        $('#c_fg').addEventListener('input', update); $('#c_bg').addEventListener('input', update); update();
      }
      if(state.tab==='presets'){
        host.innerHTML = `<div class='muted'>Pick a preset to instantly apply a world‑class brand foundation.</div><div id='presetList' style='display:grid;gap:8px;margin-top:8px'></div>`;
        fetch('brand-presets.json').then(r=>r.json()).then(list=>{
          const holder = $('#presetList'); holder.innerHTML='';
          list.forEach(p=>{
            const row=document.createElement('div'); row.className='card';
            row.innerHTML=`<div style='display:flex;justify-content:space-between;align-items:center;gap:10px'>
              <div><div style='font-weight:700'>${p.name}</div><div class='muted' style='font-size:12px'>${p.notes}</div></div>
              <div style='display:flex;gap:6px;align-items:center'>
                <div title='brand' style='width:20px;height:20px;border-radius:6px;border:1px solid rgba(255,255,255,0.12);background:${p.tokens.brand}'></div>
                <div title='alt' style='width:20px;height:20px;border-radius:6px;border:1px solid rgba(255,255,255,0.12);background:${p.tokens.brandAlt}'></div>
                <div title='accent' style='width:20px;height:20px;border-radius:6px;border:1px solid rgba(255,255,255,0.12);background:${p.tokens.accent}'></div>
              </div>
              <button class='btn' data-apply='${p.key}'>Apply</button>
            `;
            holder.appendChild(row);
            row.querySelector('button').addEventListener('click', ()=>{ state.tokens = {...state.tokens, ...p.tokens}; state.fonts.display = p.fonts.display; state.fonts.body = p.fonts.body; save(); apply(); renderPanel(); });
          });
        }).catch(()=>{ $('#presetList').textContent='Failed to load presets'; });
      }
    }
    function genPalette(base, mode){
      const toHsl = (hex)=>{ let r=parseInt(hex.slice(1,3),16)/255,g=parseInt(hex.slice(3,5),16)/255,b=parseInt(hex.slice(5,7),16)/255; const max=Math.max(r,g,b),min=Math.min(r,g,b); let h,s,l=(max+min)/2; if(max===min){ h=s=0; } else { const d=max-min; s=l>0.5? d/(2-max-min): d/(max+min); switch(max){ case r: h=(g-b)/d+(g<b?6:0); break; case g: h=(b-r)/d+2; break; case b: h=(r-g)/d+4; break; } h/=6; } return { h, s, l } };
      const toHex = (hsl)=>{ let {h,s,l}=hsl; const hue=(n)=>{ const k=(n+h*12)%12; const a=s*Math.min(l,1-l); const f=l-a*Math.max(-1, Math.min(Math.min(k-3, 9-k), 1)); return Math.round(255*f) }; const r=hue(0), g=hue(8), b=hue(4); return '#'+ [r,g,b].map(x=>x.toString(16).padStart(2,'0')).join(''); };
      const baseH = toHsl(base);
      const shifts = mode==='analogous'? [-0.06, 0, 0.06] : mode==='complementary'? [0, 0.5] : mode==='triad'? [0, 1/3, 2/3] : [0, 0.25, 0.5, 0.75];
      return shifts.map(s=>{ const h=(baseH.h + s + 1)%1; return toHex({ h, s:Math.min(1, baseH.s*1.05), l: Math.min(1, Math.max(0, baseH.l*0.98)) }); });
    }
    function onTabClick(e){ $$('.tab').forEach(t=>{ t.classList.remove('active'); t.setAttribute('aria-selected','false'); }); e.currentTarget.classList.add('active'); e.currentTarget.setAttribute('aria-selected','true'); state.tab = e.currentTarget.dataset.tab; renderPanel(); }
    $$('.tab').forEach(t=> t.addEventListener('click', onTabClick));
    $('#year').textContent = new Date().getFullYear();
    $('#fgPicker').addEventListener('input', ()=>{ const v=contrast($('#fgPicker').value, $('#bgPicker').value); $('#contrastResult').textContent = `Contrast: ${v.toFixed(2)} — ${v>=4.5? 'PASS (AA)': 'FAIL'}`; });
    $('#bgPicker').addEventListener('input', ()=>{ const v=contrast($('#fgPicker').value, $('#bgPicker').value); $('#contrastResult').textContent = `Contrast: ${v.toFixed(2)} — ${v>=4.5? 'PASS (AA)': 'FAIL'}`; });
    $('#exportBtn').addEventListener('click', ()=>{
      const files = exportArtifacts();
      download('tooloo-tokens.json', JSON.stringify(files.tokens, null, 2));
      download('tooloo-theme.css', files.css);
      download('tooloo-components.html', files.components);
    });
    $('#brandBoardBtn').addEventListener('click', async ()=>{
      try{
        const r = await fetch('/api/v1/design/brandboard', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ tokens: state.tokens, fonts: state.fonts, name: 'TooLoo Brand' }) });
        const j = await r.json(); if(!j.ok) throw new Error(j.error||'Export failed');
        window.open(j.url, '_blank');
      }catch(e){ alert('Brand board failed: '+ e.message); }
    });
    function exportArtifacts(){
      const tokens = { ...state.tokens, fonts: state.fonts };
      const css = `:root{--brand:${state.tokens.brand};--brandAlt:${state.tokens.brandAlt};--accent:${state.tokens.accent};--danger:${state.tokens.danger};--bg:${state.tokens.bg};--surface:${state.tokens.surface};--text:${state.tokens.text};--muted:${state.tokens.muted};--font-display:'${state.fonts.display}',serif;--font-body:'${state.fonts.body}',sans-serif;}`;
      const components = `<button class='btn-ui'>Default</button>\n<button class='btn-ui primary'>Primary</button>`;
      return { tokens, css, components };
    }
    function download(name, content){ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([content], {type:'text/plain'})); a.download=name; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000); }
    // Initialize
    apply(); renderPanel();
  </script>
</body>
</html>
