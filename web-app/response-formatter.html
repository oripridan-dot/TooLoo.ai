<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TooLoo Response Formatter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #333;
      margin-bottom: 8px;
      font-size: 28px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .input-section {
      background: white;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .input-section h2 {
      font-size: 18px;
      color: #333;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: inherit;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
    }

    .providers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-bottom: 15px;
    }

    .provider-input {
      display: flex;
      flex-direction: column;
    }

    .provider-input label {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .provider-input textarea {
      min-height: 100px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .output-section {
      display: none;
    }

    .output-section.active {
      display: block;
    }

    .response-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* TooLoo Response Styling */
    .tooloo-response {
      font-size: 14px;
      line-height: 1.6;
      color: #333;
    }

    .tooloo-response h2 {
      font-size: 24px;
      color: #667eea;
      margin: 20px 0 15px 0;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .tooloo-response h3 {
      font-size: 16px;
      color: #333;
      margin: 18px 0 10px 0;
      font-weight: 700;
    }

    .consensus-bar {
      margin: 10px 0;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 6px;
      font-family: 'Monaco', monospace;
      font-size: 13px;
      letter-spacing: 0.05em;
    }

    .consensus-level {
      font-size: 28px;
      font-weight: bold;
      color: #667eea;
    }

    .section-box {
      margin: 15px 0;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #667eea;
      border-radius: 4px;
    }

    .section-box.conflict {
      border-left-color: #f59e0b;
      background: #fffbf0;
    }

    .section-box.risk {
      border-left-color: #ef4444;
      background: #fef2f2;
    }

    .section-box.advisory {
      border-left-color: #10b981;
      background: #f0fdf4;
    }

    .section-box strong {
      color: #667eea;
    }

    .section-box.conflict strong {
      color: #f59e0b;
    }

    .section-box.risk strong {
      color: #ef4444;
    }

    .section-box.advisory strong {
      color: #10b981;
    }

    .consensus-point,
    .action-item,
    .next-move {
      margin: 10px 0;
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .consensus-point:last-child,
    .action-item:last-child,
    .next-move:last-child {
      border-bottom: none;
    }

    .consensus-point strong,
    .action-item strong {
      color: #667eea;
    }

    .provider-badge {
      display: inline-block;
      background: #e0e7ff;
      color: #667eea;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 5px;
    }

    .effort-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 5px;
    }

    .effort-badge.quick {
      background: #d1fae5;
      color: #065f46;
    }

    .effort-badge.moderate {
      background: #fef3c7;
      color: #92400e;
    }

    .effort-badge.complex {
      background: #fee2e2;
      color: #991b1b;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 3px solid rgba(102, 126, 234, 0.1);
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      color: #991b1b;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      display: none;
    }

    .error.active {
      display: block;
    }

    .metadata {
      display: flex;
      gap: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 6px;
      font-size: 13px;
      color: #666;
      margin-bottom: 20px;
    }

    .metadata-item {
      display: flex;
      gap: 5px;
    }

    .metadata-label {
      font-weight: 600;
      color: #333;
    }

    .copy-button {
      background: #10b981;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      margin-top: 15px;
    }

    .copy-button:hover {
      background: #059669;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }

    .tab {
      padding: 10px 15px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: #999;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.3s;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>ðŸŽ¯ TooLoo Response Formatter</h1>
      <p>Transform multi-provider AI responses into concise, actionable TooLoo format with consensus levels, conflicts, and advisory recommendations.</p>
    </div>

    <!-- Input Section -->
    <div class="input-section">
      <h2>ðŸ“¥ Input Responses</h2>

      <div class="form-group">
        <label for="query">Your Question/Query</label>
        <input
          type="text"
          id="query"
          placeholder="e.g., How should we optimize our database performance?"
          value="How should we approach database optimization?"
        />
      </div>

      <div>
        <label style="display: block; font-weight: 600; color: #333; margin-bottom: 10px; font-size: 14px;">Provider Responses</label>
        <div class="providers-grid">
          <div class="provider-input">
            <label for="claude">Claude</label>
            <textarea id="claude" placeholder="Claude's response...">Start with indexing strategy. Analyze your most frequent queries and add composite indexes for commonly joined fields. Monitor slow query logs to identify patterns before making architectural changes.</textarea>
          </div>
          <div class="provider-input">
            <label for="gpt4">GPT-4</label>
            <textarea id="gpt4" placeholder="GPT-4's response...">Consider query optimization first. Profile your queries to find bottlenecks, then evaluate indexes, caching strategies, and denormalization. Make incremental changes and measure impact at each step to avoid unintended consequences.</textarea>
          </div>
          <div class="provider-input">
            <label for="gemini">Gemini</label>
            <textarea id="gemini" placeholder="Gemini's response...">The key is systematic approach. Start with baseline metrics, identify slow queries, optimize queries before adding indexes, then consider architectural changes like sharding if needed. Quick wins first, then evaluate bigger changes.</textarea>
          </div>
        </div>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="formatResponse()">âœ¨ Format as TooLoo</button>
        <button class="btn btn-secondary" onclick="clearInputs()">Clear</button>
      </div>
    </div>

    <!-- Error Display -->
    <div class="error" id="error-box">
      <strong>Error:</strong> <span id="error-message"></span>
    </div>

    <!-- Loading State -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Processing your responses...</p>
    </div>

    <!-- Output Section -->
    <div class="output-section" id="output-section">
      <div class="metadata" id="metadata-box"></div>

      <div class="tabs">
        <button class="tab active" onclick="switchTab(this, 'formatted')">ðŸ“‹ Formatted</button>
        <button class="tab" onclick="switchTab(this, 'json')">ðŸ”§ Raw JSON</button>
      </div>

      <!-- Formatted View -->
      <div id="formatted" class="tab-content active">
        <div class="response-container">
          <div class="tooloo-response" id="formatted-response"></div>
          <button class="copy-button" onclick="copyMarkdown()">ðŸ“‹ Copy Markdown</button>
        </div>
      </div>

      <!-- JSON View -->
      <div id="json" class="tab-content">
        <div class="response-container">
          <pre id="json-response" style="background: #f5f5f5; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;"></pre>
          <button class="copy-button" onclick="copyJSON()">ðŸ“‹ Copy JSON</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentResponse = null;

    async function formatResponse() {
      const query = document.getElementById('query').value.trim();
      if (!query) {
        showError('Please enter a query');
        return;
      }

      const providerResponses = {
        claude: document.getElementById('claude').value.trim(),
        'gpt-4': document.getElementById('gpt4').value.trim(),
        gemini: document.getElementById('gemini').value.trim()
      };

      // Filter out empty responses
      const filtered = Object.fromEntries(
        Object.entries(providerResponses).filter(([, v]) => v.length > 0)
      );

      if (Object.keys(filtered).length === 0) {
        showError('Please provide at least one provider response');
        return;
      }

      showLoading(true);
      hideError();

      try {
        // Call the presentation server
        const response = await fetch('http://127.0.0.1:3012/api/v1/present', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query,
            providerResponses: filtered,
            userContext: {
              source: 'web-ui',
              timestamp: new Date().toISOString()
            }
          })
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();
        if (!data.ok) {
          throw new Error(data.error || 'Unknown error');
        }

        currentResponse = data.presentation;
        displayResponse(data.presentation);
        showOutput();
      } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Failed to format response. Is the server running on port 3012?');
      } finally {
        showLoading(false);
      }
    }

    function displayResponse(presentation) {
      const { metadata, markdown, components } = presentation;

      // Display metadata
      const metaHtml = `
        <div class="metadata-item">
          <span class="metadata-label">Providers:</span>
          <span>${metadata.providers}</span>
        </div>
        <div class="metadata-item">
          <span class="metadata-label">Consensus:</span>
          <span style="color: #667eea; font-weight: 600;">${metadata.consensusLevel}%</span>
        </div>
        <div class="metadata-item">
          <span class="metadata-label">Time:</span>
          <span>${new Date(metadata.timestamp).toLocaleTimeString()}</span>
        </div>
      `;
      document.getElementById('metadata-box').innerHTML = metaHtml;

      // Display formatted response
      document.getElementById('formatted-response').innerHTML = marked(markdown);

      // Display JSON
      document.getElementById('json-response').textContent = JSON.stringify(components, null, 2);
    }

    function switchTab(button, tabName) {
      // Remove active class from all tabs and contents
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      // Add active class to clicked tab and corresponding content
      button.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

    function showError(message) {
      const box = document.getElementById('error-box');
      document.getElementById('error-message').textContent = message;
      box.classList.add('active');
    }

    function hideError() {
      document.getElementById('error-box').classList.remove('active');
    }

    function showLoading(show) {
      const loading = document.getElementById('loading');
      if (show) {
        loading.classList.add('active');
      } else {
        loading.classList.remove('active');
      }
    }

    function showOutput() {
      document.getElementById('output-section').classList.add('active');
      document.getElementById('output-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function clearInputs() {
      document.getElementById('query').value = '';
      document.getElementById('claude').value = '';
      document.getElementById('gpt4').value = '';
      document.getElementById('gemini').value = '';
      document.getElementById('output-section').classList.remove('active');
      hideError();
    }

    function copyMarkdown() {
      if (!currentResponse) return;
      const markdown = currentResponse.markdown;
      navigator.clipboard.writeText(markdown).then(() => {
        alert('âœ… Markdown copied to clipboard');
      });
    }

    function copyJSON() {
      if (!currentResponse) return;
      const json = JSON.stringify(currentResponse.components, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        alert('âœ… JSON copied to clipboard');
      });
    }

    // Simple markdown parser for display (just basic formatting)
    function marked(markdown) {
      return markdown
        .replace(/^### (.*)/gm, '<h3>$1</h3>')
        .replace(/^## (.*)/gm, '<h2>$1</h2>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/`(.*?)`/g, '<code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">$1</code>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/^â€¢ (.*)/gm, '<li>$1</li>')
        .replace(/^- (.*)/gm, '<li>$1</li>')
        .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
        .replace(/\n/g, '<br/>')
        .replace(/(<\/p><p>)/g, '</p><p>')
        .split('\n')
        .map(line => line.includes('<') ? line : `<p>${line}</p>`)
        .join('');
    }
  </script>
</body>
</html>
