# GitHub-as-Backend Integration Guide

## Overview

TooLoo.ai uses GitHub as a comprehensive backend system, providing version control, collaboration, CI/CD, and project management capabilities beyond just code storage.

## Architecture

```
┌──────────────────────────────────────────────────┐
│           TooLoo.ai Application                   │
│                                                   │
│  ┌────────────────────────────────────────────┐  │
│  │      PersonalAIManager                     │  │
│  │  • Generate Code                           │  │
│  │  • Self-Awareness                          │  │
│  └──────────┬─────────────────────────────────┘  │
│             │                                     │
│  ┌──────────▼──────────────────────────────────┐ │
│  │  GitHubBackendManager (High-Level)         │ │
│  │  • Auto-commit workflow                    │ │
│  │  • Project sync                            │ │
│  │  • Self-improvement PRs                    │ │
│  │  • Issue-driven development                │ │
│  └──────────┬──────────────────────────────────┘ │
│             │                                     │
│  ┌──────────▼──────────────────────────────────┐ │
│  │  GitHubManager (Low-Level API)             │ │
│  │  • Files: create, read, update, delete     │ │
│  │  • Branches: list, create, switch          │ │
│  │  • Commits: list, get details              │ │
│  │  • PRs: create, update, merge              │ │
│  │  • Issues: create, update, comment         │ │
│  │  • Actions: trigger, monitor               │ │
│  └──────────┬──────────────────────────────────┘ │
└─────────────┼──────────────────────────────────────┘
              │
              ▼
    ┌─────────────────────┐
    │   GitHub API        │
    │   api.github.com    │
    └─────────────────────┘
```

## Setup

### 1. Generate GitHub Token

1. Go to GitHub Settings → Developer Settings → Personal Access Tokens → Tokens (classic)
2. Click "Generate new token"
3. Select scopes:
   - `repo` (Full control of private repositories)
   - `workflow` (Update GitHub Action workflows)
   - `write:packages` (if you want package management)
4. Copy the token

### 2. Configure Environment

Add to your `.env` file:

```env
GITHUB_TOKEN=ghp_your_token_here
GITHUB_DEFAULT_OWNER=oripridan-dot
GITHUB_DEFAULT_REPO=TooLoo.ai
GITHUB_AUTO_COMMIT=true
GITHUB_AUTO_BRANCH=true
```

### 3. Verify Configuration

```bash
curl http://localhost:3005/api/v1/github/config
```

Expected response:
```json
{
  "success": true,
  "data": {
    "configured": true,
    "authenticated": true,
    "user": {
      "login": "oripridan-dot",
      "name": "Ori Pridan"
    },
    "defaultRepo": "oripridan-dot/TooLoo.ai",
    "autoCommit": true,
    "autoBranch": true,
    "rateLimit": {
      "remaining": 4999,
      "limit": 5000,
      "reset": "2025-10-04T08:00:00.000Z"
    }
  }
}
```

## Core Workflows

### 1. Auto-Commit Generated Code

When TooLoo generates code, it can automatically commit it to GitHub:

```javascript
// Example: Generate and commit in one step
const response = await fetch('http://localhost:3005/api/v1/github/generate-and-commit', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    filePath: 'src/new-feature.js',
    content: '// Generated code here',
    message: 'Add new feature implementation',
    createPR: true,
    prTitle: 'AI Generated: New Feature',
    prBody: 'This feature was automatically generated by TooLoo.ai'
  })
});
```

**What happens**:
1. File is written locally (with backup)
2. New branch is created automatically (if `autoBranch: true`)
3. Code is committed to GitHub
4. Optional PR is created

### 2. Sync Personal Projects

Sync all projects in `personal-projects/` to GitHub:

```bash
curl -X POST http://localhost:3005/api/v1/github/sync-projects
```

**What happens**:
- Each project directory becomes a GitHub repository
- All files are committed
- `.gitignore` patterns are respected

### 3. Self-Improvement PRs

TooLoo can analyze its own code and create improvement PRs:

```javascript
const response = await fetch('http://localhost:3005/api/v1/github/self-improvement-pr', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    files: [
      {
        path: 'simple-api-server.js',
        content: '// Improved code',
        sha: 'abc123' // Current file SHA
      }
    ],
    improvements: [
      'Refactored error handling',
      'Added input validation',
      'Improved performance'
    ],
    analysisDetails: 'Detailed analysis of improvements...'
  })
});
```

**What happens**:
1. New branch created: `tooloo/self-improvement-{timestamp}`
2. All improved files are committed
3. PR is created with detailed analysis
4. You review and merge when ready

### 4. Issue-Driven Development

Fetch an issue and let AI generate a solution:

```bash
curl -X POST http://localhost:3005/api/v1/github/solve-issue \
  -H "Content-Type: application/json" \
  -d '{"issueNumber": 42}'
```

**Workflow**:
1. Fetch issue details from GitHub
2. AI analyzes the problem
3. Generate solution code
4. Commit fix and reference issue
5. Comment on issue with solution

### 5. CI/CD Integration

Trigger GitHub Actions workflows:

```javascript
const response = await fetch('http://localhost:3005/api/v1/github/actions/workflows/deploy.yml/dispatches', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    ref: 'main',
    inputs: {
      environment: 'production',
      version: '1.0.0'
    }
  })
});
```

Monitor workflow status:

```bash
curl "http://localhost:3005/api/v1/github/actions/runs?status=in_progress"
```

## API Reference

### Repository Operations

**Get repository info**:
```
GET /api/v1/github/repo?owner=X&repo=Y
```

**Get repository statistics**:
```
GET /api/v1/github/stats
```

**Get activity summary**:
```
GET /api/v1/github/activity
```

### File Operations

**List files**:
```
GET /api/v1/github/files?path=/src
```

**Read file**:
```
GET /api/v1/github/files/read?path=README.md
```

**Create/Update file**:
```
POST /api/v1/github/files
{
  "path": "src/new-file.js",
  "content": "code here",
  "message": "Add new file",
  "branch": "main",
  "sha": "abc123" // Required for updates
}
```

**Delete file**:
```
DELETE /api/v1/github/files
{
  "path": "src/old-file.js",
  "message": "Remove old file",
  "sha": "abc123" // Required
}
```

### Branch Operations

**List branches**:
```
GET /api/v1/github/branches
```

**Create branch**:
```
POST /api/v1/github/branches
{
  "newBranch": "feature/new-thing",
  "fromBranch": "main"
}
```

### Pull Request Operations

**List PRs**:
```
GET /api/v1/github/pulls?state=open
```

**Get PR details**:
```
GET /api/v1/github/pulls/123
```

**Create PR**:
```
POST /api/v1/github/pulls
{
  "title": "Add new feature",
  "body": "Description here",
  "head": "feature/branch",
  "base": "main"
}
```

**Update PR**:
```
PATCH /api/v1/github/pulls/123
{
  "title": "Updated title",
  "state": "closed"
}
```

**Merge PR**:
```
PUT /api/v1/github/pulls/123/merge
{
  "commitMessage": "Merge feature",
  "mergeMethod": "squash"
}
```

### Issue Operations

**List issues**:
```
GET /api/v1/github/issues?state=open&labels=bug
```

**Get issue**:
```
GET /api/v1/github/issues/42
```

**Create issue**:
```
POST /api/v1/github/issues
{
  "title": "Bug found",
  "body": "Description",
  "labels": ["bug", "priority-high"],
  "assignees": ["username"]
}
```

**Update issue**:
```
PATCH /api/v1/github/issues/42
{
  "state": "closed"
}
```

**Comment on issue**:
```
POST /api/v1/github/issues/42/comments
{
  "body": "This is fixed in #123"
}
```

### GitHub Actions

**List workflow runs**:
```
GET /api/v1/github/actions/runs?branch=main&status=success
```

**Get workflow run**:
```
GET /api/v1/github/actions/runs/12345
```

**Trigger workflow**:
```
POST /api/v1/github/actions/workflows/deploy.yml/dispatches
{
  "ref": "main",
  "inputs": {
    "key": "value"
  }
}
```

## Best Practices

### 1. Use Auto-Branching

Always enable `GITHUB_AUTO_BRANCH=true` to avoid committing directly to main:

```javascript
// TooLoo automatically creates feature branches
this.githubBackend.autoCommit = true;
this.githubBackend.autoBranch = true;
```

### 2. Meaningful Commit Messages

All commits are prefixed with `[TooLoo.ai]`:

```
[TooLoo.ai] Generated calculator component
[TooLoo.ai] Improve error handling in API
[TooLoo.ai] Self-improvement: refactor authentication
```

### 3. PR Descriptions

Always include:
- What was generated/changed
- Why the change was made
- Any AI analysis or recommendations

### 4. Rate Limiting

GitHub API has rate limits:
- **Authenticated**: 5,000 requests/hour
- **Unauthenticated**: 60 requests/hour

Check rate limit:
```bash
curl http://localhost:3005/api/v1/github/config | jq '.data.rateLimit'
```

### 5. Security

**Never commit**:
- `.env` files
- API keys
- Sensitive data

TooLoo respects `.gitignore` patterns when syncing projects.

## Use Cases

### Use Case 1: Daily Development Workflow

```javascript
// 1. Generate code
const code = await aiManager.generateResponse('Create a todo list component');

// 2. Auto-commit to GitHub
await githubBackend.generateAndCommit({
  filePath: 'components/TodoList.jsx',
  content: code.content,
  message: 'Add todo list component',
  createPR: true
});

// 3. Review PR on GitHub
// 4. Merge when ready
```

### Use Case 2: Bug Fix from Issue

```javascript
// 1. Fetch issue
const issue = await githubBackend.solveIssue({ issueNumber: 42 });

// 2. AI generates fix
const fix = await aiManager.generateResponse(`Fix: ${issue.title}\n\n${issue.body}`);

// 3. Commit fix
await githubBackend.generateAndCommit({
  filePath: 'src/buggy-file.js',
  content: fix.content,
  message: `Fix #42: ${issue.title}`,
  createPR: true,
  prBody: `Fixes #42\n\nAI-generated solution:\n${fix.analysis}`
});
```

### Use Case 3: Continuous Self-Improvement

```javascript
// 1. Analyze own codebase
const analysis = await selfAwarenessManager.analyzeProject();

// 2. Generate improvements
const improvements = await aiManager.generateResponse(
  `Improve this code:\n${analysis.suggestions.join('\n')}`
);

// 3. Create self-improvement PR
await githubBackend.createSelfImprovementPR({
  files: improvements.files,
  improvements: improvements.summary,
  analysisDetails: analysis.details
});
```

## Troubleshooting

### "GitHub token required"

**Problem**: Write operations fail without token.

**Solution**: Add `GITHUB_TOKEN` to `.env` file.

### "Rate limit exceeded"

**Problem**: Too many API requests.

**Solution**: 
- Wait until rate limit resets (check `rateLimit.reset`)
- Cache responses when possible
- Use webhooks instead of polling

### "Not found" errors

**Problem**: Repository or file doesn't exist.

**Solution**:
- Verify `GITHUB_DEFAULT_OWNER` and `GITHUB_DEFAULT_REPO`
- Check file paths (they're relative to repo root)
- Ensure token has correct permissions

### Auto-commit not working

**Problem**: `GITHUB_AUTO_COMMIT=true` but nothing happens.

**Solution**:
- Check GitHub token validity
- Verify network connectivity
- Check logs: `tail -f /tmp/tooloo-api.log`

## Advanced Features

### Custom Workflows

Create custom workflows by combining low-level APIs:

```javascript
async function customWorkflow() {
  // Create feature branch
  await github.createBranch({ 
    newBranch: 'feature/my-custom', 
    fromBranch: 'main' 
  });
  
  // Make multiple commits
  for (const file of filesToCreate) {
    await github.createOrUpdateFile({
      path: file.path,
      content: file.content,
      message: `Add ${file.name}`,
      branch: 'feature/my-custom'
    });
  }
  
  // Create PR
  await github.createPullRequest({
    title: 'My Custom Feature',
    body: 'Batch of changes',
    head: 'feature/my-custom',
    base: 'main'
  });
}
```

### Webhook Integration

(Future feature) Configure webhooks to trigger TooLoo workflows:

```javascript
// Webhook handler (coming soon)
app.post('/api/v1/github/webhook', async (req, res) => {
  const event = req.headers['x-github-event'];
  
  if (event === 'issues.opened') {
    // Auto-respond to new issues
    await githubBackend.solveIssue({ 
      issueNumber: req.body.issue.number 
    });
  }
  
  res.json({ success: true });
});
```

---

## Summary

GitHub integration transforms TooLoo.ai from a code generator into a complete development platform:

✅ **Version Control**: Every change is tracked  
✅ **Collaboration**: PRs and issues enable teamwork  
✅ **Automation**: CI/CD triggers and workflows  
✅ **Self-Improvement**: TooLoo evolves by analyzing itself  
✅ **Issue Resolution**: AI-driven bug fixing  

With GitHub as the backend, TooLoo.ai becomes a truly intelligent development assistant that not only generates code but manages the entire software lifecycle.
